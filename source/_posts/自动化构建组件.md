---
title: è‡ªåŠ¨åŒ–æ„å»ºç»„ä»¶
date: 2019-09-21 8:00:00
tags: semantic-release
---

# è‡ªåŠ¨åŒ–æ„å»ºç»„ä»¶
ä¸€ä¸ªç»„ä»¶çš„ä»å¼€å‘åˆ°å‘å¸ƒçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æ˜¯`å¼€å‘-æ”¹ç‰ˆæœ¬-ç¼–è¯‘-å‘å¸ƒ`ï¼Œå…¶ä¸­ï¼Œåªæœ‰å¼€å‘æ˜¯éœ€è¦è„‘åŠ›åŠ³åŠ¨çš„ï¼Œæ”¹ç‰ˆæœ¬ã€ç¼–è¯‘å’Œå‘å¸ƒåˆ™æ˜¯æœºæ¢°æ“ä½œã€‚é‚£ä¹ˆï¼Œæ˜¯å¦æœ‰å·¥å…·å¯ä»¥æŠŠæˆ‘ä»¬ä»é‡å¤çš„åŠ³åŠ¨ä¸­è§£æ”¾å‡ºæ¥å‘¢ï¼Ÿå·²ç»æœ‰äººæƒ³åˆ°äº†è¿™ä¸€ç‚¹ï¼Œå¹¶æ¨å‡ºäº†`semantic-release`ã€‚

## semantic-release
> semantic-release automates the whole package release workflow including: determining the next version number, generating the release notes and publishing the package.

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`semantic-release`å¯ä»¥æ‰¿åŒ…å¼€å‘ä¹‹å¤–çš„ä¸€ç³»åˆ—æµç¨‹ã€‚

å…¶ä¸­ï¼Œ`determining the next version number`å¼•èµ·äº†æˆ‘çš„æ³¨æ„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œç‰ˆæœ¬å·åˆ†ä¸ºä¸‰ä½`major.minor.patch`ï¼Œæ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·æ—¶ï¼Œæˆ‘éƒ½è¦æƒ³ä¸€ä¸‹è¦æ”¹`minor`è¿˜æ˜¯`patch`ï¼Œä¸€ä¸ªå·¥å…·åˆå¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ
ç­”æ¡ˆæ˜¯æ ¹æ®gitæäº¤æ—¶çš„`commit message`ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œä½ åœ¨commit messageä¸­å†™é“ï¼š`fix: fix TypeError`ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ—¶å€™å°±åº”è¯¥å¢åŠ `patch`ä½ï¼›å¦‚æœä½ å†™çš„æ˜¯`feat: add auto fix feature`ï¼Œé‚£ä¹ˆå°±åº”è¯¥åŠ `minor`ä½ã€‚

ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ`commit message`åº”è¯¥æœ‰å‡ ç§ä¸åŒçš„ç±»å‹ï¼Œ`semantic-release`å¯ä»¥ä»æäº¤è®°å½•ä¸­ï¼Œåˆ†æè¿™äº›ç±»å‹ï¼Œå¹¶è®¡ç®—å¾—åˆ°ç‰ˆæœ¬å·ã€‚

é‚£ä¹ˆï¼Œ`commit message`æœ‰å“ªäº›ç±»å‹å‘¢ï¼Ÿåˆæ˜¯å¦æœ‰å·¥å…·å¯ä»¥è¿›è¡Œè§„èŒƒå‘¢ï¼Ÿ

## commitizen
æ­¤å¤„ï¼Œæˆ‘ä»¬ä»¥[ Angular Commit Message Conventions](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines)ä¸ºä¾‹ï¼Œå…±8ç§ç±»å‹ã€‚

ä¸ºäº†è§„èŒƒï¼Œæˆ‘ä»¬å¼•å…¥[commitizen](https://github.com/commitizen/cz-cli)ä½œä¸ºç®¡ç†å·¥å…·ã€‚å®‰è£…é…ç½®åï¼Œæ¯æ¬¡git commitæ“ä½œï¼Œéƒ½æ‰§è¡Œå‘½ä»¤`npm run commit`ï¼Œæ­¤æ—¶å¯ä»¥ä¾æ¬¡é€‰æ‹©`type`ã€`scope`ç­‰ï¼Œæ¥ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„`commit message`ã€‚

## travis
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€‰æ‹©[travis](https://travis-ci.org/)ä½œä¸ºCIï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬è¦åšçš„å°±åªæœ‰`git commit`+`git push`ï¼Œå‰©ä¸‹çš„ä¸€åˆ‡å°±éƒ½äº¤ç»™å·¥å…·äº†ã€‚

travisåªæ”¯æŒGitHubé¡¹ç›®æ‰˜ç®¡ï¼Œå¦‚æœç”¨GitLabç­‰ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–çš„CIã€‚

é¦–å…ˆæ­£ç¡®é…ç½®GitHubå’Œnpmçš„æƒé™ï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¢åŠ travisé…ç½®æ–‡ä»¶`.travis.yml`ï¼š
```yml
language: node_js
cache:
  directories:
    - ~/.npm
notifications:
  email: false
node_js:
  - '10'
  - '11'
  - '8'
script:
  - npm run test:prod && npm run build
after_success:
  - if [ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ]; then npm run travis-deploy-once "npm run semantic-release"; fi
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
```

æœ€åï¼Œæˆ‘ä»¬å†å›å¤´ï¼ŒæŠŠ`semantic-relaese`çš„é…ç½®æ–‡ä»¶`.releaserc`è¡¥ä¸Šï¼š

```json
{
    "branch": "master",
    "plugins": [
        "@semantic-release/commit-analyzer",
        [
            "@semantic-release/npm",
            {
                "tarballDir": "dist"
            }
        ],
        [
            "@semantic-release/github",
            {
                "assets": "dist/*.tgz"
            }
        ],
    ]
}
```

æœ¬æ–‡å¯¹äºè¯¦ç»†çš„semiotic-releaseå’Œtravisé…ç½®å¹¶æ²¡æœ‰æ¶‰åŠï¼Œå› ä¸ºè¿™äº›åœ¨å®˜æ–¹æ–‡æ¡£ä¸­éƒ½æœ‰è¯¦ç»†çš„æè¿°ã€‚

OKï¼Œå¤§åŠŸå‘Šæˆï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œä¿®æ”¹`.releaserc`æ–‡ä»¶ï¼Œæ¯”å¦‚ç”Ÿæˆchangelogã€ä¿®æ”¹æ ¹æ®`commit message`ä¿®æ”¹ç‰ˆæœ¬å·çš„ç­–ç•¥ç­‰ã€‚

æ„å»ºæˆåŠŸçš„è¯ï¼Œä½ å°±å¯ä»¥åœ¨ä½ çš„npmä¸‹å‘ç°ä½ çš„npmåŒ…äº†~
